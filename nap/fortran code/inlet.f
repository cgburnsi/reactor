	SUBROUTINE INLET
C	*************************************************************
C
c	THIS SUBROUTINE CALCULATES THE BOUNDARY MESH POINTS AT THE NOZZLE
C 	INLET FOR SUBSONIC FLOW
C
C	*************************************************************
C
	COMMON /AV/ IAV,CAV,NST,SMP,LSS,CTA,XMU,XLA,RKMU,QUT(81,21),QVT(81
   1,21),QPT(81,21)
	COMMON /ONESID/ UD(4),VD(4),PD(4),ROD(4)
	COMMON /SOLUTN/ U(8l,21,2),V(8l,21,2),P(8l,21,2),RO(81,2l,2)
	COMMON /CNTRLC/ LMAX,MMAX,NMAX,NPRINT,TCONV,FDT,GAMMA,RGAS,GAM1,GA
   1M2,L1,L2,L3,Ml,M2,DX,DY,DT,N,N1,N3,NASM,IVEL,ICHAR,N1D,LJET,JFLAG,
   2IERR,IUI,IUO,DXR,DYR,LD,MD,LMD1,LMD3,IB,RSTAR,RSTARS,NPLOT,G,PC,TC
   3,LC,PLOW,ROLOW
	COMMON /GEMTRYC/ NGEOM,XI,RI,XT,RT,XE,RE,RCI,RCT,ANGI,ANGE,XW(8l),
   1YW(8l),XWI(8l),YWI(8l),NXNY(8l),NWPTS,IINT,IDIF,LT,NDIM
	COMMON /GCB/ NGCB,XICB,RICB,XTCB,RTCB,XECB,RECB,RCICB,RCTCB,ANGICB
   1,ANGECB,XCB(8l),YCB(8l),XCBI(81),YCBI(8l),NXNYCB(8l),NCBPTS,IINTCB
   2,IDIFCB,LECB
	COMMON /BCC/ PT(21),TT(21),THETA(21),PE,MASSE,MASSI,MASST,THRUST,N
   1STAG
	REAL MN3,NXNY,MASSI,MASST,NXNYCB,MASSE
C
	GRGB=GAMMA*RGAS*G
	X3=XI
	ATERM2=0.0
	ATERM3=0.0
	DO 180 ICHAR=1,2
	DO 180 M=1,MMAX
	LMN1=1+LD*(M-1)+LMD1
	LMN3=1+LD*(M-1)+LMD3
	L1MN1=2+LD*(M-1)+LMD1
	L1M1N1=2+LD*(M-2)+LMD1
	LM1N1=1+LD*(M-2)+LMD1
	LM1N3=1+LD*M+LMD3
	CALL MAP (2,1,M,AL,BE,DE,2,AL1,BE1,DE1)
	U2=U(LMN1)
	A2=SQRT(GAMMA*P(LMN1)/RO(LMN1))
	IF (ICHAR,EQ,2) GO TO 10
	U(LMN3)=U2
	V(LMN3)=V(LMN1)
	A3=A2
C
C	CALCULATE THE PROPERTY INTERPOLATING POLYNOMIAL COEFFICIENTS
C
10	BU=(U(L1MN1)-U(LMN1))*DXR
	BV=(V(L1MN1)-V(LMN1))*DXR
	BU=(P(L1MN1)-P(LMN1))*DXR
	BRO=(RO(L1MN1)-(LMN1))*DXR
	BYCB=(YCB(2)-YCB(1))*DXR
	BAL=(AL1-AL)*DXR
	BBE=(BE1-BE)*DXR
	CU=U(1,M,N1)-BU*X3
	CV=V(1,M,N1)-BV*X3
	CP=P(1,M,N1)-B*X3
	CRO=RO(1,M,N1)-BRO*X3
	CYCB=YCB(1)-BYCB*X3
	CAL=AL-BAL*X3
	CBE=BE-BBE*X3
C
C	CALCULATE THE CROSS DERIVATIVE INTERPOLATING POLYNOMIAL
C	COEFFICIENTS
C
	IF (M,EQ,1) GO TO 20
	DU=(U(L1MN1)-U(L1M1N1))*DYR
	DV=(V(L1MN1)-V(L1M1N1))*DYR
	DP=(P(L1MN1)-P(L1M1N1))*DYR
	DRO=(RO(L1MN1)-RO(L1M1N1))*DYR
	DU1=(U(LMN1)-U(LM1N1))*DYR
	DV1=(V(LMN1)-V(LM1N1))*DYR
	DP1=(P(LMN1)-P(LM1N1))*DYR
	DRO1=(RO(LMN1)-RO(LM1N1))*DYR
	GO TO 40
20	IF (NGCB,NE,0) GO TO 30
	DU=0.0
	DV=V(2,2,N1)*DYR
	DP=0.0
	DRO=0.0
	DU1=0.0
	DV1=V(1,2,N1)*DYR
	DP1=0.0
	DRO1=0.0
	GO TO 40
30	DU=(U(2,2,N1)-U(2,1,N1))*DYR
	DV=(V(2,2,N1)-V(2,1,N1))*DYR
	DP=(P(2,2,N1)-P(2,1,N1))*DYR
	DRO=(RO(2,2,N1)-RO(2,1,N1))*DYR
	DU1=(U(1,2,N1)-U(1,1,N1))*DYR
	DV1=(V(1,2,N1)-V(1,1,N1))*DYR
	DP1=(P(1,2,N1)-P(1,1,N1))*DYR
	DRO1=(RO(1,2,N1)-RO(1,1,N1))*DYR
40	BDU=(DU-DU1)*DXR
	BDV=(DV-DV1)*DXR
	BDP=(DP-DP1)*DXR
	BDRO=(DRO-DRO1)*DXR
	CDU=DU1-BDU*X3
	CDV=DV1-BDV*X3
	CDP=DP1-BDP*X3
	CDRO=DRO1-BD*X3
C
C	CALCULATE X2
C
	IF (ICHAR,EQ,2) A3=SQRT(GAMMA*P(LMN3)/RO(LMN3))
	DO 50 IL=1,2
	X2=X3-(U(1,M,N3)-A3+U2-A2)*0.5*DT
C
C	INTERPOLATE FOR THE PROPERTIES
C
	U2=BU*X2+CU
	P2=BP*X2+CP
	RO2=BRO*X2+CRO
	A2=SQRT(GAMMA*P2/RO2)
50	CONTINUE
	V2=BV*X2+CV
	YCB2=BYCB*X2+CYCB
	AL2=BAL*X2+CAL
	BE2=BBE*X2+CBE
	UV2=U2*AL2+V2*BE2
C
C	INTERPOLATE FOR THE CROSS DERIVATIVES
C
	DU2=BDU*X2+CDU
	DV2=BDV*X2+CDV
	DP2=BDP*X2+CDP
	DRO2=BDRO*X2+CDRO
C
C	CALCULATE THE PSI TERMS
C
	IF (NDIM,EQ,0) GO TO 70
	IF (M,EQ,1,AND,NGCB,EQ,0) GO TO 60
	ATERM2=RO2*V2/(DY*(M-1)/(BE2+YCB2)
	GO TO 70
60	ATERM2=RO2*BE2*DV2
70	PSI12=-UV2*DRO2-RO2*AL2*DU2-RO2*BE2*DV2-ATERM2
	PSI22=-UV2*DU2-AL2*DP2/RO2
	PSI42=-UV2*DP2+A2*A2*UV2*DRO2
	IF (CHAR,EQ,1) GO TO 130
C
C	CALCULATE THE CROSS DERIVATIVES AT THE SOLUTION POINT
C
	IF (M,EQ,1,AND,NGCB,EQ,0) GO TO 80
	IF (M,EQ,MMAX) GO TO 90
	DU3=(U(LM1N3)-U(LMN3))*DYR
	DV3=(V(LM1N3)-V(LMN3))*DYR
	DP3=(P(LM1N3)-P(LMN3))*DYR
	DRO3=(RO(LM1N3)-RO(LMN3))*DYR
	GO TO 100
80	DU3=0.0
	DV3=V(1,2,N3)*DYR
	DP3=0.0
	DRO3=0.0
	GO TO 100
90	DU3=(U(1,MMAX,N3)-U(1,M1,N3))*DYR
	DV3=(V(1,MMAX,N3)-V(1,M1,N3))*DYR
	DP3=(P(1,MMAX,N3)-P(1,M1,N3))*DYR
	DRO3=(RO(1,MMAX,N3)-(1,M1,N3))*DYR
C
C	CALCULATE THE PSI TERMS AT THE SOLUTION POINT
C
100	IF (NDIM,EQ,0) GO TO 120
	IF (M,EQ,1,AND,NGCB,EQ,0) GO TO 110
	ATERM3=RO(LMN3)*V(LMN3)/(DY*M-1)/BE+YCB(1))
	GO TO 120
110	ATERM3=RO(LMN3)*BE*DV3
120	UV3=U(LMN3)*AL+V(LMN3)*BE
	PSI13=-UV3*DRO3-RO(LMN3)*AL*DU3-RO(LMN3)*BE*DV3-ATERM3
	PSI23=-UV3*DU3-AL*DP3/RO(LMN3)
	PSI43=-UV3*DP3+A3*A3*UV3*DRO3
	GO TO 140
130	PSI23=PSI22
	PSI43=PSI42
	PSI13=PSI12
C
C	SOLVE THE COMPATIBILITY EQUATIONS FOR U,V,P, AND RO
C
140	MN3=SQRT(U(LMN3)*U(LMN3)+V(LMN3)*V(LMN3))/A3
	T2=P2/(RO2*RGAS*G)
	PSI1B=(PSI12+PSI13)*0.5
	PSI2B=(PSI22+PSI23)*0.5
	PSI4B=(PSI42+PSI43)*0.5
	GPSI1B=GAMMA*PSI1B
	TTHETA=TAN(THETA(M))
	UCORR=0.5+0.5/SQRT(1.0+TTHETA*TTHETA)
C
	DO 160 ITER=1,20
	DEM=(1.0+GAM2*MN3*MN3)
	P(LMN3)=PT(M)/(DEM**GAM1)
	T3=TT(M)/DEM
	PB=(P2+P(LMN3))*0.5
	RTB=RGAS*(T2+T3)*0.5*G
	U(LMN3)=U2+DT*PSI2B+(P(LMN3)-P2-(PSI4B+RTB*GPSI1B)*DT)*SQRT(RTB/GA
   1MMA)/PB
	U(LMN3)=U(LMN3)*UCORR
	V(LMN3)=-U(LMN3)*TTHETA
	OMN3=MN3
	MN3=SQRT((U(LMN3)*U(LMN3)+V(LMN3)*V(LMN3))/(T3*GRGB))
	IF (OMN3,NE,0.0) GO TO 150
	IF (ABS(MN3-OMN3),LE,0.0001) GO TO 170
	GO TO 160
150	IF (ABS((MN3-OMN3)/OMN3),LE,0.001) GO TO 170
160 CONTINUE
C
	PRINT 190, M,N
170	RO(LMN3)=P(LMN3)/(RGAS*T3*G)
180 CONTINUE
	RETURN
C
190	FORMAT (1H0,58H***** THE SOLUTION FOR NOZZLE ENTRANCE BOUNDARY POI
   1NT ( 1,,I2,1H,,I4,43H) FAILED TO CONVERGE IN 20 ITERATIONS *****)
	END



	



